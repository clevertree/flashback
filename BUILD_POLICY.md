# Build Policy

**ENFORCED RULE: Never commit broken builds**

All commits to this repository must have passing builds verified before pushing. This ensures the main branch is always in a working state.

## Pre-Commit Checklist

Before any commit:

1. ✅ Run tests: `npm run test`
2. ✅ Build frontend: `npm run build`
3. ✅ Build Tauri app: `npm run tauri:build`

All three must pass without errors.

## .gitignore

The following are excluded from version control:

- `target/` - Rust build artifacts
- `Cargo.lock` - Cargo dependency lock (can cause version conflicts)
- `.next/` - Next.js build output
- `node_modules/` - npm dependencies
- `.env*.local` - Local environment files
- `dist/` - Built distributions

## Build Status

### Current State

- ✅ Jest tests: 5/5 passing
- ✅ Next.js build: Successful
- ✅ Tauri build: Successful (Release profile, 49.97s)

### Recent Fixes (Commit: 73d7c2c)

**tauri build error resolution:**

1. **Issue**: Rust compilation failed with missing dependencies
   - **Solution**: Added `reqwest 0.11`, `uuid 1.6`, `chrono 0.4` to `fabric-core/Cargo.toml`

2. **Issue**: Async Send trait not implemented for MutexGuard
   - **Solution**: Replaced `std::sync::Mutex` with `tokio::sync::Mutex` in AppState
   - Updated all command handlers to use `.await` on mutex.lock() calls

3. **Issue**: build.rs API incompatibility
   - **Solution**: Updated to use `Attributes::new()` for tauri-build 1.5.6 API

## Untracked Files (Safe to Ignore)

These files are gitignored and safe to leave:
- `next-env.d.ts` - Auto-generated by Next.js
- `package-lock.json` - Auto-generated by npm
- `src-tauri/tauri.conf.json` - Generated copy

## Commit Enforcement

Any commit that violates the build policy should:
1. Be identified before push
2. Be reset with `git reset --soft HEAD~1`
3. Have build failures resolved
4. Be recommitted only after all builds pass

This policy ensures code quality and prevents cascading failures.
